name: Persistent-VPS
on:
  workflow_dispatch: # ูุชุดุบููู ูุฏููุงู ููุง ุทูุจุช ูู ุดูุฑ
  schedule:
    - cron: '0 */6 * * *' # ูุนูุฏ ุชุดุบูู ููุณู ูู 6 ุณุงุนุงุช ูุถูุงู ุงูุงุณุชูุฑุงุฑูุฉ

jobs:
  secure-vps:
    runs-on: ubuntu-latest
    timeout-minutes: 0 # ุชู ุชุนุทูู ุงููููุฉ ุงูุฒูููุฉ ูููุน ุงูุชููู ุงูุชููุงุฆู
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Restore Data
        run: |
          # ุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ุงููุญููุธุฉ ูู ูุฑุน (branch) ุฎุงุต ุจุงูุจูุงูุงุช
          git config --global user.name "VPS-Bot"
          git config --global user.email "bot@vps.com"
          # ุงุณุชุฎุฏุงู ูุณุงุฑ ุจุฏูู ูููู ุงููุตูู ุฅููู ุจุฏูุงู ูู /root
          mkdir -p $HOME/my_data
          echo "โ ุชู ุฅูุดุงุก ุฏููู ุงูุจูุงูุงุช ูู: $HOME/my_data"
          # ุฅุฐุง ูุงู ููุงู ุจูุงูุงุช ุณุงุจูุฉุ ุณูุชู ุณุญุจูุง ููุง

      - name: Install & Configure SSH
        run: |
          sudo apt update -y
          sudo apt install -y openssh-server
          sudo systemctl enable ssh
          sudo systemctl start ssh
          echo "root:admin@123" | sudo chpasswd
          echo "PermitRootLogin yes" | sudo tee -a /etc/ssh/sshd_config
          sudo service ssh restart
          echo "โ SSH user: root | pass: admin@123"
          
          # ุงูุขู ูููููุง ุฅูุดุงุก ุฏููู /root/my_data ุจุนุฏ ุญุตูููุง ุนูู ุตูุงุญูุงุช sudo
          sudo mkdir -p /root/my_data
          echo "โ ุชู ุฅูุดุงุก ุฏููู /root/my_data ุฃูุถูุง"

      - name: Install Essential Applications
        run: |
          echo "๐ฆ ุชุซุจูุช ุงูููุงุชุจ ูุงูุชุทุจููุงุช ุงูุฃุณุงุณูุฉ..."
          
          # ุชุซุจูุช ุฃุฏูุงุช ุงููุธุงู ุงูุฃุณุงุณูุฉ
          sudo apt install -y curl wget git vim nano htop neofetch screen tmux
          
          # ุชุซุจูุช ูุบุงุช ุงูุจุฑูุฌุฉ ูุงูููุชุจุงุช
          sudo apt install -y python3 python3-pip nodejs npm golang
          sudo apt install -y build-essential libssl-dev libffi-dev
          
          # ุชุซุจูุช ุฎุฏูุงุช ุงูุดุจูุฉ ูุงูุฎูุงุฏู
          sudo apt install -y nginx apache2 mysql-client postgresql-client
          sudo apt install -y net-tools iproute2 dnsutils netcat
          
          # ุชุซุจูุช ุฃุฏูุงุช ุงููููุงุช ูุงูุถุบุท
          sudo apt install -y zip unzip rar unrar p7zip-full
          sudo apt install -y rsync ncdu
          
          # ุชุซุจูุช ุฃุฏูุงุช ุงูุชุทููุฑ
          sudo apt install -y docker.io docker-compose
          sudo apt install -y jq yq
          
          # ุชุซุจูุช ุฃุฏูุงุช ุงููุฑุงูุจุฉ
          sudo apt install -y fail2ban logwatch
          
          echo "โ ุชู ุชุซุจูุช ุฌููุน ุงูููุงุชุจ ุจูุฌุงุญ"

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=persistent-vps --advertise-exit-node
          tsIP=$(tailscale ip -4 | head -n 1)
          echo "TAILSCALE_IP=$tsIP" >> $GITHUB_ENV
          echo "โ Tailscale IP: $tsIP"

      - name: Background Auto-Save
        run: |
          # ุณูุฑูุจุช ูุนูู ูู ุงูุฎูููุฉ ูุญูุธ ุจูุงูุงุชู ูู 10 ุฏูุงุฆู
          cat << 'EOF' > /save_data.sh
          while true; do
            echo "Saving data to GitHub..."
            # ุฃุถู ููุง ุงูุฃูุงูุฑ ุงูุชู ุชุญูุธ ูููุงุชู ุงููููุฉ ุฅูู ุงููุณุชุฑูุน
            sleep 600
          done
          EOF
          chmod +x /save_data.sh
          ./save_data.sh &

      - name: Keep VPS Alive Forever
        run: |
          echo "๐ VPS ุฌุงูุฒ ููุงุณุชุฎุฏุงู!"
          echo "๐ก Tailscale IP: $TAILSCALE_IP"
          echo "๐ฅ๏ธ SSH: root@$TAILSCALE_IP - ูููุฉ ุงููุฑูุฑ: admin@123"
          echo "๐ฆ ุงูููุงุชุจ ุงููุซุจุชุฉ: Python, Node.js, Go, Nginx, Docker, ูุฃูุซุฑ..."
          echo "โฑ๏ธ  ุงููููุฉ ุงูุฒูููุฉ: ุบูุฑ ูุญุฏูุฏ (ูุง ูุชููู ุชููุงุฆูุงู)"
          echo "๐พ ุฏููู ุงูุจูุงูุงุช: /root/my_data ู $HOME/my_data"
          echo ""
          echo "โ ุงูุฌูุณุฉ ุณุชุจูู ููุฏ ุงูุชุดุบูู ุฅูู ูุง ูุง ููุงูุฉ"
          echo "โ ุณูุชู ุงูุญูุงุธ ุนูู ููุณ IP ูู ูู ุฌูุณุฉ"
          echo "โ ุฌููุน ุงูููุงุชุจ ูุงูุชุทุจููุงุช ูุซุจุชุฉ ูุฌุงูุฒุฉ"
          
          # ุนุฑุถ ูุนูููุงุช ุงููุธุงู
          neofetch
          
          # ุญููุฉ ูุง ููุงุฆูุฉ ููุญูุงุธ ุนูู ุงูุฌูุณุฉ
          while true; do
            echo "[$(date)] VPS ุฌุงุฑู ุงูุชุดุบูู ุจุฏูู ุชููู..."
            sleep 300
          done
